jQuery(document).ready(function(){var a={readyLabels:[],formCollector:[],validatedAllready:0,setAnchor:{},init:function(a){console.log("Init."),this.setAnchor=a},validate:function(a,b){var c=a.closest("form").attr("id"),d=c.split("-")[1],e=Number(d)+1,f=jQuery("#"+c).find("[data-require=y] input:NOT([name=versicherungsnr]), [data-require=y] select"),g=this.validateFormFields(f,b),h=g.collector,i=g.groupBox,j=g.errorArray,k=[],l=this.formCollector;if(l[d]=jQuery("#"+c).serializeArray(),k=this.hiLiteError(j,c,h,i,b),j.length>0?0:1){var m="#check-tab-"+e;this.readyLabels.push(e),"submit"===b&&(jQuery(m).click(),this.setAnchor(jQuery(".formular"),jQuery("header")),"tab-3"!==c?this.bringDataToFront(l):(console.log("%s, %O","abschicken",l),jQuery.post("inc/form_val.php",{data:l}).done(function(a){console.info(a)})))}else"submit"===b&&(this.validatedAllready=1,k.length&&"tab-3"!==c?this.setAnchor(jQuery("#"+c+" .formular-box[data-position="+k[0].split("_")[1]+"]"),jQuery("header")):this.setAnchor(jQuery(".formular"),jQuery("header")))},validateFormFields:function(a,b){var c=0,d=[],e={},f={};if(a.each(function(){var a,c,g=jQuery(this),h=g.attr("id"),i=g.parent().parent(),j=i.parent().parent().data("position"),k=g.attr("type"),l={};if("datenschutz"===h&&(j=i.closest("[data-position]").data("position")),f["position_"+j]=f["position_"+j]||[],f["position_"+j].push(h),"checkbox"===k)g.prop("checked")?"datenschutz"!==h?i.removeClass("error"):i.parent().parent().removeClass("error"):"precheck"!==b&&("datenschutz"!==h?i.addClass("error"):i.parent().parent().addClass("error"),d.push(h));else if("radio"===k)a=g.attr("name"),c=g.prop("checked"),l={title:h,value:c},e[a]=e[a]||[],e[a].push(l);else if("text"===k){var m=g.val();if(null===m||""===m)"precheck"!==b&&i.addClass("error"),"strasse"===h||"hausnr"===h?(a="strasse_hausnr",l={title:h,value:c},e[a]=e[a]||[],e[a].push(l)):"plz"===h||"ort"===h?(a="plz_ort",l={title:h,value:c},e[a]=e[a]||[],e[a].push(l)):d.push(h);else if(i.removeClass("error"),"email"===h){var n=m.indexOf("@"),o=m.lastIndexOf(".");1>n||n+2>o||o+2>=m.length?("precheck"!==b&&i.addClass("error"),d.push(h)):i.removeClass("error")}}else"anrede"===g.attr("id")&&("anrede"===g.val()?("precheck"!==b&&i.addClass("error"),d.push(h)):i.removeClass("error"))}),0!==Object.getOwnPropertyNames(e).length){var g=Object.keys(e);g.map(function(a){var c=e[a],f=[];c.length&&(c.map(function(a){a.value||f.push(a.title)}),c.length===f.length&&d.push(a)),c.map(function(a){c.length===f.length?"precheck"!==b&&jQuery("#"+a.title).parent().parent().addClass("error"):jQuery("#"+a.title).parent().parent().removeClass("error")})})}return c&&console.log("%s: %O","Debug",d),{errorArray:d,collector:e,groupBox:f}},hiLiteError:function(a,b,c,d,e){jQuery("#"+b).find(".show-error-box").removeClass("show-error-box"),jQuery("#"+b).find(".show-info-box").removeClass("show-info-box");var f=Object.keys(d),g=[];a.forEach(function(a){if("kundeninfo"===a)a=c[a][0].title;else if("strasse_hausnr"===a||"plz_ort"===a){var b=a.split("_")[0];a=b}f.forEach(function(b){d[b].indexOf(a)>=0&&(g[b.split("_")[1]]=b)}),"precheck"!==e&&jQuery("#"+a).parent().parent().children(".icon-achtung-round").click()});var h=[];return f.forEach(function(a,c){var d=Number(g.indexOf(a));-1===d?jQuery("#"+b+" .formular-box[data-position="+(c+1)+"]").addClass("completed"):(jQuery("#"+b+" .formular-box[data-position="+(c+1)+"]").removeClass("completed"),h.push(a))}),h},bringDataToFront:function(a){var b,c,d,e=this.mergeFormData(a),f=jQuery("#tab-3"),g=f.find("[data-out-personal]"),h=[];if(void 0!==e.tarife){var i=f.find("."+e.tarife);jQuery(".ihr-gewaehlter-tarif").removeClass("active"),jQuery(i).addClass("active"),"on"===e.tierhalterrisiko?jQuery(i).find(".zusatz-1").addClass("active"):jQuery(i).find(".zusatz-1").removeClass("active"),"on"===e.gewaesserschadensrisiko?jQuery(i).find(".zusatz-2").addClass("active"):jQuery(i).find(".zusatz-2").removeClass("active"),"on"===e.tierhalterrisiko||"on"===e.gewaesserschadensrisiko?jQuery(i).find(".einschluss-zusatzrisiken").addClass("active"):jQuery(i).find(".einschluss-zusatzrisiken").removeClass("active")}var j="Kein Versicherungskunde";"kundeninfo-ja"===e.kundeninfo&&void 0!==e.versicherungsnr&&e.versicherungsnr.length&&(j="Versicherungsnummer ("+e.versicherungsnr+")"),jQuery(".personal-data [data-out=kundeninfo]").text(j);var k="";"angebotsversand-email"===e.angebotsversand?k="Angebotsversand per E-Mail":"angebotsversand-post"===e.angebotsversand&&(k="Angebotsversand per Post"),jQuery(".personal-data [data-out=angebotsversand]").text(k),g.each(function(){var a=jQuery(this);b=a.data("out-personal"),h=b.split("_"),c="",d="",h.map(function(a){c+=d+e[a],d=" "}),a.text(c)})},validateSubmit:function(a){this.validate(a,"submit")},validateKeydown:function(a){this.validate(a,"keydown")},validatePreCheck:function(a){this.validate(a,"precheck")},mergeFormData:function(a){var b=[];return a.map(function(a){a.map(function(a){b[a.name]=a.value})}),b},getReadyLabels:function(){return this.readyLabels},getValidatedAllready:function(){return this.validatedAllready}};!function(){try{jQuery("#geburtsdatum").mask("99.99.9999",{autoclear:!1})}catch(b){console.info("%s","Assuming not a 'formular', because \"jQuery.mask\" not loaded!")}jQuery("form[name=tab-3] .icon-signatur").on("click",function(){var a=jQuery(this).parent().data("step"),b=jQuery("label[for=check-tab-"+a+"]");b.click()}),a.init(setAnchor);var c=a.getReadyLabels(),d=a.getValidatedAllready();jQuery(".formular .submit").on("click",c,function(b){b.preventDefault(),a.validateSubmit(jQuery(this))}),jQuery("[data-require=y] input:NOT([name=versicherungsnr]), [data-require=y] select").on("keypress keyup change",d,function(){d?a.validateKeydown(jQuery(this)):a.validatePreCheck(jQuery(this))}),jQuery(".formular .nav-set label").on("click",c,function(a){var b=jQuery(this),d=b.attr("for"),e=Number(d.split("-")[2]),f=b.parent().parent().find(".active").attr("for"),g=Number(f.split("-")[2]),h=jQuery("#tab-"+g+" .submit");e>g?-1===c.indexOf(e)?a.preventDefault():h.click():(3===g&&jQuery("#datenschutz").prop("checked",!1),h.click())}),jQuery(".formular .icon-achtung-round").on("click",function(){jQuery(this).parent().toggleClass("show-error-box")}),jQuery(".formular .question-mark").on("click",function(){jQuery(this).parent().toggleClass("show-info-box")}),jQuery(".formular .icon-x").on("click",function(){var a=jQuery(this),b=a.parent().parent();b.removeClass("show-error-box show-info-box")}),jQuery(".box-form input, .box-form select, .box-form textarea").on("focus",function(){jQuery(this).parent().parent().addClass("hi-lite")}).on("blur",function(){jQuery(this).parent().parent().removeClass("hi-lite")}),jQuery(".box-form .form-kundeninfo-ja input[name=kundeninfo]").on("change",function(){jQuery(this).parent().children("input[name=versicherungsnr]").focus()}),jQuery(".box-form .form-kundeninfo-ja input[name=versicherungsnr]").on("keydown",function(){jQuery("#tab-2 label[for=kundeninfo-ja]").click()}),jQuery(".formular .back").on("click",setAnchor,function(a){a.preventDefault();var b=jQuery(this),c=b.parent().parent().attr("id"),d=c.split("-")[1],e=Number(d)-1,f="#check-tab-"+e;jQuery(f).click(),setAnchor(jQuery(".formular"),jQuery("header"))})}(setAnchor,a)});